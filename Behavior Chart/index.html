<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Behavior Chart</title>
    <link rel="icon" type="image/x-icon" href="images/favicon.ico">
    <link href="styles.css" rel="stylesheet">  
</head>
<body>
    <div>
        <h1> Roster Behavior Chart </h1>
    </div>

    <div class="mobile_grid">
    <div class="chart">
        <img src="images/5.png">
        <img src="images/4.png">
        <img src="images/2.png">
        <img src="images/1.png">
        <img src="images/3.png"> 
    </div>
      
      <div id="grid">
        <div class="column c1" data-column="0"></div>
        <div class="column c2" data-column="1"></div>
        <div class="column c3" data-column="2"></div>
        <div class="column c4" data-column="3"></div>
        <div class="column c5" data-column="4"></div>
      </div>
    </div>

      <form id="addForm">
        <input type="text" id="newItemText" placeholder="Enter text" required>
        <button type="submit">Add New Player</button>
      </form>
      
    <!-- Modular Firebase v12 -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { getDatabase, ref, push, set, onValue, update, remove } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";
      
        // ====== Firebase Setup ======
        const firebaseConfig = {
          apiKey: "AIzaSyCCqBV0Y5skN3W7H3leex9p4CvQIoqdLJE",
          authDomain: "bekah-s-roster.firebaseapp.com",
          databaseURL: "https://bekah-s-roster-default-rtdb.firebaseio.com",
          projectId: "bekah-s-roster",
          storageBucket: "bekah-s-roster.appspot.com",
          messagingSenderId: "115134763139",
          appId: "1:115134763139:web:4a57ad54ad498bb6"
        };
      
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
      
        // ====== DOM References ======
        const columns = document.querySelectorAll('.column');
        const addForm = document.getElementById('addForm');
        const newItemText = document.getElementById('newItemText');
      
        // Updated column colors
        const columnColors = ["green", "yellow", "darkorange", "#804e36", "red"];
      
        let draggedItem = null;
      
        function createItemElement(id, text, column) {
          const div = document.createElement('div');
          div.className = 'item';
          div.textContent = text;
          div.dataset.id = id;
          div.draggable = true;
          
          // Set background color
          div.style.backgroundColor = columnColors[column] || "gray";
          // Set text color: black only for yellow (column 1)
          div.style.color = column === 1 ? "black" : "white";
      
          // Drag events
          div.addEventListener('dragstart', () => { draggedItem = div; });
          div.addEventListener('dragend', () => { draggedItem = null; });
      
          // Delete button
          const deleteBtn = document.createElement('button');
          deleteBtn.textContent = 'âœ–';
          deleteBtn.style.color = "black"; // match text color
          deleteBtn.addEventListener('click', e => {
            e.stopPropagation();
            remove(ref(db, 'items/' + id));
          });
          div.appendChild(deleteBtn);
      
          return div;
        }
      
        // ====== Drag & Drop ======
        columns.forEach(col => {
          col.addEventListener('dragover', e => e.preventDefault());
          col.addEventListener('drop', () => {
            if (draggedItem && draggedItem.parentElement !== col) {
              col.appendChild(draggedItem);
              const id = draggedItem.dataset.id;
              const newColumn = Number(col.dataset.column);
      
              // Update column and color in Firebase
              update(ref(db, 'items/' + id), { column: newColumn, color: columnColors[newColumn] });
      
              // Update rectangle style
              draggedItem.style.backgroundColor = columnColors[newColumn];
              draggedItem.style.color = newColumn === 1 ? "black" : "white";
              draggedItem.querySelector('button').style.color = draggedItem.style.color;
            }
          });
        });
      
        // ====== Add New Item ======
        addForm.addEventListener('submit', e => {
          e.preventDefault();
          const text = newItemText.value.trim();
          if (!text) return;
      
          const newItemRef = push(ref(db, 'items'));
          set(newItemRef, {
            text: text,
            column: 1,                  // default column 2
            color: columnColors[1]      // yellow
          });
          newItemText.value = '';
        });
      
        // ====== Load Items ======
        onValue(ref(db, 'items'), snapshot => {
          const items = snapshot.val();
          columns.forEach(col => col.innerHTML = '');
          if (!items) return;
      
          for (const id in items) {
            const item = items[id];
            const el = createItemElement(id, item.text, item.column);
            if (columns[item.column]) columns[item.column].appendChild(el);
          }
        });
      
      </script>

</body>
</html>